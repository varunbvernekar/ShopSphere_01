<!-- product-page.html -->
<div class="page-wrapper">
  <div class="page-container">
    <!-- CUSTOMER EXPERIENCE -->
    <ng-container *ngIf="role === 'CUSTOMER'; else staffView">


      <ng-container [ngSwitch]="view">
        <ng-container *ngSwitchCase="'catalog'">
          <app-product-catalog [products]="products" (productSelect)="handleSelectProduct($event)">
          </app-product-catalog>
        </ng-container>

        <ng-container *ngSwitchCase="'customizer'">
          <app-product-customizer *ngIf="selectedProduct" [product]="selectedProduct" (back)="handleBackToCatalog()"
            (addToCart)="handleAddToCart($event)">
          </app-product-customizer>
        </ng-container>

        <ng-container *ngSwitchCase="'cart'">
          <app-cart [items]="cartItems" (updateQuantity)="handleUpdateQuantity($event)"
            (removeItem)="handleRemoveItem($event)" (continueShopping)="handleContinueShopping()"
            (checkout)="handleCheckout()">
          </app-cart>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- ADMIN PRODUCT PAGE -->
    <ng-template #staffView>
      <!-- ✅ Only show this block if the logged-in user is ADMIN -->
      <div *ngIf="isAdmin">
        <header class="page-header">
          <h1 class="page-title">Admin Product Management</h1>
          <p class="page-subtitle">
            Add new products to the catalog. This section is visible only for admin users.
          </p>
        </header>

        <h2 class="section-title">Add New Product</h2>

        <!-- Success Message -->
        <div class="success-message" *ngIf="showSuccessMessage">
          <span class="material-symbols-rounded">check_circle</span>
          Product successfully added!
        </div>

        <div class="form-grid">
          <div class="form-group full-width">
            <label>Product Name</label>
            <input type="text" [(ngModel)]="newProduct.name" placeholder="e.g. Elegant Gold Necklace" />
          </div>

          <div class="form-group full-width">
            <label>Description</label>
            <textarea [(ngModel)]="newProduct.description" rows="3" placeholder="Enter product description"></textarea>
          </div>

          <div class="form-group">
            <label>Category</label>
            <select [(ngModel)]="newProduct.category">
              <option value="" disabled selected>Select Category</option>
              <option value="Jewelry">Jewelry</option>
              <option value="Accessories">Accessories</option>
              <option value="Home Decor">Home Decor</option>
              <option value="Kitchen">Kitchen</option>
              <option value="other">other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Price (₹)</label>
            <input type="number" [(ngModel)]="newProduct.basePrice" min="0" placeholder="0.00" />
          </div>

          <div class="form-group">
            <label>Stock Level</label>
            <input type="number" [(ngModel)]="newProduct.stockLevel" min="0" placeholder="0" />
          </div>

          <div class="form-group">
            <label>Reorder Threshold</label>
            <input type="number" [(ngModel)]="newProduct.reorderThreshold" min="0" placeholder="0" />
          </div>

          <div class="form-group full-width">
            <label>Product Image</label>
            <div class="file-upload-container">
              <input type="file" (change)="onFileSelected($event)" accept="image/*" id="productImage"
                class="file-input" />
              <label for="productImage" class="file-label">
                <span class="material-symbols-rounded">cloud_upload</span>
                <span *ngIf="!selectedFileName">Choose an image file...</span>
                <span *ngIf="selectedFileName">{{ selectedFileName }}</span>
              </label>
            </div>
            <div *ngIf="imagePreview" class="image-preview-box">
              <img [src]="imagePreview" alt="Preview" />
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button class="primary-btn" (click)="onAddProduct()"
            [disabled]="!newProduct.name || !newProduct.basePrice || !newProduct.category || !imagePreview">
            <span class="material-symbols-rounded">add</span>
            Add Product
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</div>